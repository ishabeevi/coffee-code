{% extends "base.html" %}
{% block title %}Top Matched Donors â€“ LifeLink{% endblock %}

{% block content %}
<div class="page-header">
    <div>
        <h2>ğŸ” Top Matched Donors</h2>
        <p class="sub">
            For <strong>{{ blood_req.blood_group }}</strong> at
            <strong>{{ blood_req.hospital }}</strong>, {{ blood_req.location.title() }}
            {% if blood_req.emergency %}<span class="badge-emergency ml-sm">ğŸš¨ Emergency</span>{% endif %}
        </p>
    </div>
    <a href="/requests" class="btn-secondary">â† Back</a>
</div>

{% if matched_donors %}
<div class="match-list">
    {% for donor in matched_donors %}
    <div class="match-card">
        <a href="/profile/{{ donor.id }}" class="match-avatar">{{ donor.name[0].upper() }}</a>
        <div class="match-info">
            <a href="/profile/{{ donor.id }}" class="match-name">{{ donor.name }}</a>
            <div class="match-details">
                <span class="blood-badge">{{ donor.blood_group }}</span>
                <span class="loc-tag">ğŸ“ {{ donor.location.title() }}</span>
                {% if donor.location.strip().lower() == blood_req.location.strip().lower() %}
                <span class="same-loc">âœ… Same City</span>
                {% endif %}
                <span class="pts-tag">â­ {{ donor.points }} pts</span>
            </div>
            <div class="match-status {% if donor.available %}status-avail{% else %}status-unavail{% endif %}">
                {% if donor.available %}ğŸŸ¢ Available{% else %}ğŸ”´ Unavailable{% endif %}
            </div>
        </div>
        <div class="match-action">
            {% if user and user.id == donor.id %}
            <a href="/donate/{{ blood_req.id }}" class="btn-primary">Confirm Donation</a>
            {% else %}
            <a href="tel:{{ donor.contact }}" class="btn-secondary">ğŸ“ Contact</a>
            {% endif %}
        </div>
    </div>
    {% endfor %}
</div>

{% if user %}
<div class="donate-self">
    <p>Are you available to donate?</p>
    <a href="/donate/{{ blood_req.id }}" class="btn-primary">ğŸ©¸ I'll Donate</a>
</div>
{% endif %}

{% else %}
<div class="empty-state">
    <div class="empty-icon">ğŸ”</div>
    <h3>No eligible donors found</h3>
    <p>No donors match this request right now. Try later or expand the location.</p>
    <a href="/requests" class="btn-secondary">â† Back to Requests</a>
</div>
{% endif %}
{% endblock %}